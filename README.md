# Whisper - Распознавание речи и транскрибация

Этот проект представляет собой набор инструментов на базе **OpenAI Whisper** для высококачественного распознавания речи (транскрибации) из видео- и аудиофайлов. Он включает в себя как простые утилиты для отдельных задач, так и полностью автоматизированные скрипты для пакетной обработки. Особое внимание уделено оптимизации производительности при использовании GPU.

## Ключевые возможности

*   **Пакетная обработка**: Автоматическая обработка всех видеофайлов в указанной папке.
*   **Оптимизация для GPU**: Скрипты для проверки, настройки и оптимизации использования видеопамяти, что позволяет работать с самыми крупными моделями Whisper.
*   **Определение языка и перевод**: Возможность автоматически определять язык аудио и, для английского языка, выполнять прямой перевод на русский.
*   **Гибкость**: Набор скриптов для разных задач — от простого извлечения аудио до сложной транскрибации с выбором параметров.
*   **Генерация субтитров**: Создание файлов формата `.txt` (чистый текст) и `.srt` (субтитры с таймкодами).
*   **Простота установки**: Включает скрипты для упрощения настройки окружения.

## Установка

**Шаг 1: Установка Python**

Убедитесь, что у вас установлен **Python 3.8 или выше**.
*   Скачайте его с [официального сайта](https://www.python.org/downloads/).
*   **Важно**: Во время установки в Windows обязательно отметьте галочку **"Add Python to PATH"**.

**Шаг 2: Установка FFmpeg**

FFmpeg — это необходимый инструмент для работы с аудио- и видеофайлами.
*   **Windows**:
    1.  Скачайте архив с [официального сайта FFmpeg](https://ffmpeg.org/download.html).
    2.  Распакуйте его в удобное место (например, `C:\ffmpeg`).
    3.  Запустите файл `setup_ffmpeg.bat` от имени администратора. Он автоматически добавит путь к FFmpeg в переменные окружения. **После этого перезапустите терминал или IDE.**
*   **Linux (Debian/Ubuntu)**:
    ```bash
    sudo apt update && sudo apt install ffmpeg
    ```
*   **macOS (через Homebrew)**:
    ```bash
    brew install ffmpeg
    ```

**Шаг 3: Настройка проекта**

1.  Клонируйте или скачайте этот репозиторий в удобную папку.
2.  Откройте терминал (командную строку) в папке проекта.
3.  Обновите `pip` до последней версии:
    ```bash
    python -m pip install --upgrade pip
    ```4.  Установите все необходимые библиотеки из файла `requirements.txt`:
    ```bash
    pip install -r requirements.txt
    ```
5.  Для максимальной совместимости и производительности рекомендуется обновить ключевые библиотеки до последних версий:
    ```bash
    pip install --upgrade torch numpy ffmpeg-python tqdm
    pip install --upgrade git+https://github.com/openai/whisper.git
    ```

## Использование и описание скриптов

Вот описание доступных скриптов и сценариев их использования.

### `check_gpu.py` — Диагностика GPU

*   **Для чего**: Этот скрипт предназначен для проверки правильности настройки вашей видеокарты NVIDIA и CUDA. Он выводит подробную информацию о GPU, драйверах и версиях библиотек.
*   **Когда использовать**: Запустите его в первую очередь, если у вас есть GPU и вы хотите убедиться, что система готова к работе, или если вы столкнулись с ошибками, связанными с CUDA.
*   **Как запустить**:
    ```bash
    python check_gpu.py
    ```

---

### `extract_audio.py` — Ручное извлечение аудио

*   **Для чего**: Извлекает аудиодорожку из одного видеофайла и сохраняет её в отдельный файл (`.mp3`, `.wav` и т.д.).
*   **Когда использовать**: Если вам нужно только получить аудио из видео без последующей транскрибации, или если вы хотите подготовить аудиофайл для обработки в другой программе.
*   **Как запустить**:
    ```bash
    python extract_audio.py --video_file <путь_к_видео>
    ```
*   **Параметры**:
    *   `--video_file` (обязательный): Путь к вашему видеофайлу (например, `my_video.mp4`).
    *   `--format` (необязательный): Формат выходного аудиофайла. По умолчанию `mp3`. Доступные варианты: `mp3`, `wav`, `m4a`.
        *   *Пример*: `python extract_audio.py --video_file video.mp4 --format wav`

---

### `whisper_progress.py` — Продвинутая транскрибация аудиофайла

*   **Для чего**: Это основной скрипт для транскрибации **одного аудиофайла**. Он отображает детальный прогресс, позволяет интерактивно выбрать модель и устройство (CPU/GPU), а также генерирует `.txt` и `.srt` файлы.
*   **Когда использовать**: Когда у вас есть один аудиофайл (или вы уже извлекли его с помощью `extract_audio.py`) и вы хотите получить его текстовую расшифровку с максимальным контролем над процессом.
*   **Как запустить**:
    ```bash
    python whisper_progress.py --audio_file <путь_к_аудио>
    ```
    После запуска скрипт предложит вам выбрать устройство (CPU или GPU) и модель Whisper.
*   **Параметры**:
    *   `--audio_file` или `-a` (обязательный): Путь к аудиофайлу (например, `audio.mp3`).
    *   `--model` или `-m` (необязательный): Название модели Whisper. Если не указать, скрипт предложит выбрать из списка. Это полезно, если вы хотите автоматизировать запуск.
        *   *Модели*: `tiny`, `base`, `small`, `medium`, `large`, `large-v2`, `large-v3`.
        *   *Пример*: `python whisper_progress.py -a audio.wav -m large-v3`

---

### `process_videos.py` — Полностью автоматическая обработка папки

*   **Для чего**: Автоматизирует весь процесс для **пакетной обработки**. Скрипт находит все видеофайлы в папке `video/`, извлекает из них аудио и транскрибирует с использованием самой качественной модели `large-v3`.
*   **Когда использовать**: Идеальный вариант, когда у вас есть много видео, которые нужно обработать с максимальным качеством без ручного вмешательства. Просто поместите файлы в папку и запустите скрипт.
*   **Как запустить**:
    1.  Поместите все ваши видеофайлы в папку `video/`.
    2.  Запустите скрипт без параметров:
        ```bash
        python process_videos.py
        ```    Скрипт автоматически определит, можно ли использовать GPU, и начнет обработку. Результаты (`.txt` и `.srt`) будут сохранены в той же папке `video/`.

---

### `process_videos_with_lang.py` — Пакетная обработка с определением языка и переводом

*   **Для чего**: Это самый продвинутый скрипт для пакетной обработки. Он не только транскрибирует видео из папки `video/`, но и сначала **определяет язык аудио**. Если язык — английский, он предложит выбор: транскрибировать на английском или сразу **перевести на русский**.
*   **Когда использовать**: Если вы работаете с разноязычным контентом или часто обрабатываете англоязычные видео и хотите сразу получать русский текст.
*   **Как запустить**:
    1.  Поместите видеофайлы в папку `video/`.
    2.  Запустите скрипт:
        ```bash
        python process_videos_with_lang.py
        ```
    Скрипт будет работать автоматически, но остановится и запросит ваш ввод, если обнаружит видео на английском языке.

---

### `transcribe.py` — Базовая транскрибация

*   **Для чего**: Упрощенный скрипт для транскрибации одного аудиофайла. В отличие от `whisper_progress.py`, он менее интерактивен и содержит жёстко заданные параметры (например, язык "ru").
*   **Когда использовать**: В основном для быстрой проверки или отладки. Для конечного использования рекомендуется более функциональный `whisper_progress.py`.
*   **Как запустить**:
    1.  Переименуйте ваш аудиофайл в `input.mp3` и положите его в корень проекта.
    2.  Запустите скрипт:
        ```bash
        python transcribe.py
        ```

## Рекомендации по выбору скрипта

| Ваша задача                                                               | Рекомендуемый скрипт                 |
| ------------------------------------------------------------------------- | ------------------------------------ |
| У меня много видео, и я хочу получить субтитры для всех сразу.            | `process_videos.py`                  |
| У меня много видео на разных языках, некоторые нужно перевести с английского. | `process_videos_with_lang.py`        |
| У меня один аудиофайл, и я хочу видеть прогресс и выбрать модель.           | `whisper_progress.py`                |
| Мне нужно только извлечь звук из видео.                                   | `extract_audio.py`                   |
| Я хочу проверить, готова ли моя видеокарта к работе.                        | `check_gpu.py`                       |

## Поддерживаемые форматы

Проект поддерживает все популярные аудио- и видеоформаты благодаря FFmpeg, включая:
*   **Видео**: `.mp4`, `.mkv`, `.avi`, `.mov`, `.webm` и др.
*   **Аудио**: `.mp3`, `.wav`, `.m4a`, `.flac`, `.ogg` и др.